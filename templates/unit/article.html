{% macro article(page, article, index, desc) %}
    {% import 'unit/post.html' as post %}

    {% if theme.index.expand %}
        {% if page.layout == 'photo' and article.photos and article.photos|length %}
            {{ post.gallery(article) }}
        {% endif %}

        <article class="post-expand {{ article.layout }}" itemprop="articleBody">
            {{ post.header(article) }}

            <div class="article-content">
                {% if article.excerpt and index %}
                    {{ article.excerpt }}
                {% else %}
                    {{ article.content }}
                {% endif %}

                <p class="article-more-link">
                    {% if article.excerpt and index and theme.index.excerpt_link %}
                        <a href="{{ url_for(article.path) }}#more">{{ theme.index.excerpt_link }}</a>
                    {% endif %}
               </p>
            </div>

            {{ post.footer(article, index=true) }}
        </article>
    {% else %}
        <section class="post" itemscope itemprop="blogitem">
            {% if article.link %}
                <a href="{{ article.link }}" target="_blank">
            {% else %}
                <a href="{{ config.root }}{{ article.path }}" title="{{ article.title }}" itemprop="url">
            {% endif %}

            <h1 itemprop="name">{{ article.title }}</h1>

            {% if theme.show_article_desc %}
                {% if article.description %}
                    <p itemprop="description" >{{ article.description }}</p>
                {% elif article.excerpt %}
                    <p itemprop="description" >{{ get_article_desc(article.excerpt) }}</p>
                {% else %}
                    <p itemprop="description" >{{ get_article_desc(article.content) }}</p>
                {% endif %}
            {% endif %}

            <time datetime="{{ date_xml(article.date) }}" itemprop="datePublished">{{ article.date.strftime(config.date_format) }}</time>
          </a>
        </section>
    {% endif %}
{% endmacro %}