{# 文章 #}
{% macro article(item, table) %}
    <div id="main" class="{{ item.layout }}" itemscope itemprop="blogPost">
        {% if page.layout == 'photo' %}
            {{ gallery() }}
        {% endif %}

        <article itemprop="articleBody">
            {{ header() }}
            <div class="article-content">
                {% if table and (item.toc != false) and theme.toc.article %}
                    <div id="toc" class="toc-article">
                        <strong class="toc-title">{{ gettext('contents') }}</strong>
                        {% if item.list_number == false %}
                            {{ toc(item.content, {'list_number': false}) }}
                        {% else %}
                            {{ toc(item.content) }}
                        {% endif %}
                    </div>
                {% endif %}
                {{ item.content }}
            </div>
            {{ footer() }}
        </article>
        {{ pagination() }}
        {{ comment() }}
    </div>
{% endmacro %}

{# 分类 #}
{% macro catetags(item) %}
    <div class="article-catetags">
        {% if item.categories and item.categories|length %}
            <div class="article-categories">
              <span></span>
                {{ list_categories(item.categories, {
                'show_count': false,
                'class': 'article-category',
                'style': 'none',
                'separator': '►'})
                }}
            </div>
        {% endif %}

        {% if item.tags and item.tags|length %}
            <div class="article-tags">
                {% set tags = [] %}

                {% for tag in tags %}
                    {{ tags.append('<a href="' + config.root + tag.path + '">' + tag.name + '</a>') }}
                {% endfor %}

                <span></span> {{ ''.join(tags) }}
             </div>
        {% endif %}
    </div>
{% endmacro %}

{# 评论 #}
{% macro comment(page) %}
    {% if theme.duoshuo_shortname and page.comments %}
        <section id="comments" class="comment">
            <div class="ds-thread" data-thread-key="{{ page.path }}" data-title="{{ page.title }}" data-url="{{ page.permalink }}"></div>
        </section>
    {% endif %}

    {% if (config.disqus_shortname or theme.disqus_shortname) and page.comments %}
        <section id="comments" class="comment">
          <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          </div>
        </section>
    {% endif %}
{% endmacro %}

{# 脚注 #}
{% macro footer(item, index) %}
    <footer class="article-footer clearfix">
        {{ catetags() }}

        {% if not index %}
            <div class="article-share" id="share">
            {% if theme.jiathis.enable %}
                <div class="share-jiathis">
                    {{ jiathis() }}
                </div>
            {% else %}
                <div data-url="{{ item.permalink }}" data-title="{% if item.title %} {{ item.title }} | {{ config.title }} {% endif %}"
                     data-tsina="<%= theme.author.tsina %>" class="share clearfix">
                </div>
            {% endif %}
            </div>
        {% endif %}

        {% if index %}
            <div class="comments-count">
                {% if (config.disqus_shortname or theme.disqus_shortname) and not theme.duoshuo_shortname %}
                    <span></span>
                    <a href="{{ config.root }}{{ item.path }}#disqus_thread" class="comments-count-link">Comments</a>
                {% elif theme.duoshuo_shortname %}
                    <span></span>
                    <a href="{{ config.root }}{{ item.path }}#comments" class="ds-thread-count comments-count-link" data-thread-key="{{ item.path }}" data-count-type="comments">&nbsp;</a>
                {% endif %}
            </div>
        {% endif %}
    </footer>
{% endmacro %}

{# 画廊 #}
{% macro gallery(item) %}
    <div class="gallery">
        <div class="photoset">
          {% if item.photos|length %}
              {% for photo in item.photos %}
                  <img src="{{ photo }}">
              {% endfor %}
          {% else %}
              <img src="{{ item.photos }}">
          {% endif %}
        </div>

        <div class="control">
        <div class="prev"></div>
        <div class="next"></div>
        </div>
    </div>
{% endmacro %}

{# 头部 #}
{% macro header(item) %}
    <header class="article-info clearfix">
      <h1 itemprop="name">
          {% if item.link %}
              <a href="{{ item.link }}" target="_blank" title="{{ item.title }}">{{ item.title }}</a>
          {% else %}
              <a href="{{ config.root }}{{ item.path }}" title="{{ item.title }}" itemprop="url">{{ item.title }}</a>
          {% endif %}
      </h1>

      <p class="article-author">By
          {% if theme.author.google_plus %}
              <a href="https://plus.google.com/{{ theme.author.google_plus }}?rel=author" title="{{ config.author }}" target="_blank" itemprop="author">{{ config.author }}</a>
          {% else %}
              <a href="{{ config.root }}about" title="{{ config.author }}" target="_blank" itemprop="author">{{ config.author }}</a>
          {% endif %}
      <p class="article-time">
        <time datetime="{{ date_xml(item.date) }}" itemprop="datePublished"> {{ gettext('datepublished') }} {{ item.date.strftime(config.date_format) }}</time>
      </p>
    </header>
{% endmacro %}


{% macro jiathis() %}
    {% if theme.jiathis.enable %}
        <div class="jiathis_style_24x24">
            <a class="jiathis_button_tsina"></a>
            <a class="jiathis_button_weixin"></a>
            <a class="jiathis_button_renren"></a>
            <a class="jiathis_button_qzone"></a>
            <a class="jiathis_button_googleplus"></a>
            <a class="jiathis_button_douban"></a>
            <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
            <a class="jiathis_counter_style"></a>
        </div>

        <script type="text/javascript" >
            var jiathis_config= {
                        data_track_clickback: true,
                        sm: "copy,renren,cqq",
                        pic: "<%- item.photos %>",
                        summary: "",
                        {% if theme.jiathis.tsina %}
                            relateuid: {"tsina": "<%= theme.jiathis.tsina %>"},
                            hideMore: false
                        {% endif %}
                    }
          </script>

        <script type="text/javascript" src="//v3.jiathis.com/code/jia.js?uid={% if theme.jiathis.id %} {{ theme.jiathis.id }} {% endif %}" charset="utf-8"></script>
    {% endif %}
{% endmacro %}

{# 上下文导航 #}
{% macro pagination(page) %}
    {% if page.prev or page.next %}
        <nav class="article-nav clearfix">
            {% if page.prev %}
                <div class="prev" >
                    <a href="{{ config.root }}{{ page.prev.path }}" title="{{ page.prev.title }}">
                        <strong>上一篇：</strong><br/>
                        <span>
                            {% if page.prev.title %}
                                {{ page.prev.title }}
                            {% else %}
                                no title
                            {% endif %}
                        </span>
                    </a>
                </div>
            {% endif %}

            {% if page.next %}
                <div class="next">
                    <a href="{{ config.root }}{{ page.next.path }}"  title="{{ page.next.title }}">
                     <strong>下一篇：</strong><br/>
                        <span>
                            {% if page.next.title %}
                                {{ page.next.title }}
                            {% else %}
                                no title
                            {% endif %}
                        </span>
                    </a>
                </div>
            {% endif %}
        </nav>
    {% endif %}
{% endmacro %}